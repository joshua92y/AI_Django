{% load humanize %}
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ìƒí’ˆ ëª©ë¡</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    tr[data-href] {
      cursor: pointer;
      transition: background-color 0.2s;
    }
    tr[data-href]:hover {
      background-color: #f1f1f1;
    }
  </style>
</head>
<body class="bg-light">
  <div class="container mt-5">

    <!-- í—¤ë” -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 class="mb-0">ğŸ“‹ ìƒí’ˆ ëª©ë¡</h2>
      <a href="{% url 'home' %}" class="btn btn-primary">í™ˆìœ¼ë¡œ</a>
      <a href="{% url 'product_add' %}" class="btn btn-primary">+ ìƒí’ˆ ë“±ë¡</a>
    </div>

    <!-- ê²€ìƒ‰ì°½ -->
    <form method="get" action="{% url 'product_list' %}" class="input-group mb-4">
      <input type="text" name="q" class="form-control" placeholder="ìƒí’ˆëª… ë˜ëŠ” ì œì¡°ì‚¬ ê²€ìƒ‰"
             value="{{ search_query|default:'' }}">
      <button type="submit" class="btn btn-outline-secondary">ê²€ìƒ‰</button>
    </form>

    <!-- ìƒí’ˆ í…Œì´ë¸” -->
    <div class="table-responsive">
      <table class="table table-bordered table-hover align-middle text-center bg-white shadow-sm">
        <thead class="table-primary">
          <tr>
            <th>ë²ˆí˜¸</th>
            <th>ì´ë¦„</th>
            <th>ê°€ê²©</th>
            <th>ì œì¡°ì‚¬</th>
            <th>ì œì¡°ì¼ì</th>
            <th>ê´€ë¦¬</th>
          </tr>
        </thead>
        <tbody>
          {% for product in products %}
          <tr data-href="{% url 'product_detail_by_query' %}?id={{ product.number }}">
            <td>{{ product.number }}</td>
            <td>{{ product.name }}</td>
            <td>{{ product.price|intcomma }}ì›</td>
            <td>{{ product.manufacturer }}</td>
            <td>{{ product.made_date }}</td>
            <td>
              <a href="{% url 'product_edit' %}?id={{ product.number }}" class="btn btn-sm btn-outline-primary">ìˆ˜ì •</a>
              <button class="btn btn-sm btn-outline-danger" onclick="deleteProduct('{{ product.number }}')">ì‚­ì œ</button>
              <a href="{% url 'product_copy' %}?id={{ product.number }}" class="btn btn-sm btn-outline-success">ë³µì‚¬</a>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="text-muted">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- JS: tr í´ë¦­ & ì‚­ì œ ì²˜ë¦¬ -->
  <script>
    // tr í´ë¦­ â†’ ìƒì„¸ë³´ê¸°, ë²„íŠ¼ í´ë¦­ì€ ë¬´ì‹œ
    document.querySelectorAll("tr[data-href]").forEach(row => {
      row.addEventListener("click", (e) => {
        if (e.target.tagName === 'A' || e.target.tagName === 'BUTTON') return;
        window.location = row.dataset.href;
      });
    });

    // ì‚­ì œ ì²˜ë¦¬
    function deleteProduct(id) {
      if (!confirm("ì •ë§ ì‚­ì œí• ê¹Œìš”?")) return;
      fetch(`/store/delete/?id=${id}`)
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            alert("ì‚­ì œ ì™„ë£Œ");
            location.reload();
          } else {
            alert("ì‚­ì œ ì‹¤íŒ¨: " + (data.error || "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"));
          }
        });
    }
  </script>
</body>
</html>
